(function(f){f.fn.extend({"wtselect":function(l){l=l||{};return this.each(function(){if(this.controller){this.controller.setOptions(l)}else{if(f.isPlainObject(l)){this.controller=new d(this,l)}}})}});var h={formatDefaultOption:function(){return"<option value=''>--请选择--</option>"},mimeTypes:"image/jpg,image/jpeg,image/png,image/gif,image/bmp"};var d=function(l,m){this.input=l;var n=f(this.input);this.options=f.extend({},{formatDefaultOption:m.formatDefaultOption||h.formatDefaultOption(),formatOptions:m.formatOptions||null,cacheable:n.attr("data-wt-cacheable")=="false",lazyload:n.attr("data-wt-lazyload")||"false",formatName:n.attr("data-wt-name"),formatValue:n.attr("data-wt-value"),formatParams:n.attr("data-wt-params")||"",formatUrl:n.attr("data-wt-url")||"",paramSelector:n.attr("data-wt-paramSelector"),parentSelector:n.attr("data-wt-parentSelector"),},m);g(this)};var g=function(l){var o=f(l.input);var m=l.options;var n=this;o.change(function(){f(this).attr("data-wt-select-value",f(this).val())});if(m.parentSelector!=null){if(m.lazyload=="false"){e(o,m)}f(m.parentSelector).change(function(){e(o,m);k.apply(n,[l])})}else{if(m.lazyload=="false"){e(o,m);k(l)}}};var e=function(m,l){m.empty();if(l.formatDefaultOption!=null){m.append(f(l.formatDefaultOption))}m.attr("data-wt-select-value","")};var k=function(l){var s=f(l.input);var n=l.options;var m=n.formatUrl;var p=this;var r=n.formatParams;if(n.paramSelector!=null&&n.formatParams!=null){r=b(f(n.paramSelector),n.formatParams)}if(n.cacheable&&f.fn.wtselect.cacheData[m+r]!=null&&f.fn.wtselect.cacheData[m+r]!=undefined){console.log("从缓存获取数据");var q=f.fn.wtselect.cacheData[m+r];if(n.formatName!=null&&n.formatValue!=null){var o=c.apply(p,[q.data,n.formatName,n.formatValue]);s.append(f(o))}else{if(n.formatOptions!=null&&q.data!=null&&q.data.length>0){s.append(f(n.formatOptions(q.data)))}else{i.apply(p,["wtselect配置错误,需要定义formatOptions 或 定义data-wt-key及data-wt-value"])}}s.trigger("change");return}WT.wt_ajax_formdata_silent(m,r,function(u){f.fn.wtselect.cacheData[m+r]=u;if(n.formatName!=null&&n.formatValue!=null){var t=c.apply(p,[u.data,n.formatName,n.formatValue]);s.append(f(t))}else{if(n.formatOptions!=null&&u.data!=null&&u.data.length>0){s.append(f(n.formatOptions(u.data)))}else{i.apply(p,["wtselect配置错误,需要定义formatOptions 或 定义data-wt-key及data-wt-value"])}}s.trigger("change")})};var c=function(m,q,l){var n="";for(var o in m){var p=j(m[o],q);var r=j(m[o],l);n+="<option value='"+r+"'>"+p+"</option>"}return n};var j=function(p,l){var r=l.match(/\{[^\}]+\}/g);for(var n in r){var q=r[n];var m=q.substring(1,q.length-1);var o=(p[m]==null||p[m]==undefined)?"":p[m];l=l.replace(q,o)}return l};var b=function(l,m){var r=m.match(/\{[^\}]+\}/g);for(var o in r){var q=r[o];var n=q.substring(1,q.length-1);var p=(l.attr(n)==null||l.attr(n)==undefined)?"":l.attr(n);m=m.replace(q,p)}return m};f.fn.wtselect.cacheData={};var a=function(l){console.log(l)};var i=function(l){console.error(l)}})(jQuery);